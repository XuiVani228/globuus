<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ГЛОБУС - Магазин канцелярии</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            padding-bottom: 60px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: bold;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-button {
            color: white;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        
        .nav-button:hover {
            background-color: #34495e;
        }
        
        .profile-btn {
            background-color: #3498db;
        }
        
        .cart-btn {
            background-color: #e74c3c;
            position: relative;
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #fff;
            color: #e74c3c;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .hero {
            height: 60vh;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1585637071663-799845ad5212?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 0 15px;
        }
        
        .hero h1 {
            font-size: 28px;
            margin-bottom: 15px;
        }
        
        .hero p {
            font-size: 16px;
            margin-bottom: 20px;
            max-width: 100%;
        }
        
        .btn {
            display: inline-block;
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 16px;
            transition: background-color 0.3s;
            cursor: pointer;
            border: none;
        }
        
        .btn:hover {
            background-color: #c0392b;
        }
        
        .btn-back {
            background-color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .btn-back:hover {
            background-color: #6c7a7d;
        }
        
        .about {
            padding: 40px 0;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .about-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .about-text {
            order: 2;
        }
        
        .about-image {
            order: 1;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .about-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .contacts {
            padding: 40px 0;
            background-color: #f1f1f1;
        }
        
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .contact-card {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .contact-card h3 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        /* Стили для каталога товаров */
        .products {
            padding: 40px 0;
            background-color: white;
        }
        
        .categories {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .category-btn {
            padding: 8px 15px;
            background-color: #ecf0f1;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            white-space: nowrap;
            font-size: 14px;
        }
        
        .category-btn:hover, .category-btn.active {
            background-color: #3498db;
            color: white;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .product-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .product-card:hover {
            transform: translateY(-3px);
        }
        
        .product-image {
            height: 150px;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-title {
            font-size: 16px;
            margin-bottom: 8px;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            font-weight: bold;
            color: #e74c3c;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .add-to-cart {
            width: 100%;
            padding: 8px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        
        .add-to-cart:hover {
            background-color: #34495e;
        }
        
        /* Модальное окно товара */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            max-width: 95%;
            width: 100%;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .product-modal {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .product-modal-image {
            width: 100%;
        }
        
        .product-modal-image img {
            width: 100%;
            border-radius: 10px;
        }
        
        .product-modal-info {
            width: 100%;
        }
        
        .product-modal-title {
            font-size: 22px;
            margin-bottom: 10px;
        }
        
        .product-modal-price {
            font-size: 20px;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .product-modal-description {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .product-modal-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            background-color: #ecf0f1;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-input {
            width: 50px;
            text-align: center;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        footer {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        
        /* Стили для страницы корзины */
        .cart-page {
            padding: 40px 0;
            background-color: white;
        }
        
        .cart-items {
            margin-bottom: 30px;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            gap: 15px;
        }
        
        .cart-item-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-title {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .cart-item-price {
            font-weight: bold;
            color: #e74c3c;
            font-size: 16px;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .remove-item {
            color: #e74c3c;
            cursor: pointer;
            font-size: 18px;
        }
        
        .cart-summary {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .total {
            font-weight: bold;
            font-size: 18px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        
        /* Стили для формы оформления заказа */
        .checkout-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        /* Стили для страницы профиля */
        .profile-page {
            padding: 40px 0;
            background-color: white;
        }
        
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;
        }
        
        .profile-info h2 {
            margin-bottom: 5px;
            font-size: 20px;
        }
        
        .profile-orders {
            margin-top: 30px;
        }
        
        .order-card {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .order-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            gap: 5px;
        }
        
        .order-products {
            margin-top: 10px;
        }
        
        .order-product {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .order-product img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        /* Админ панель */
        .admin-panel {
            margin-top: 30px;
            padding: 15px;
            background-color: #f1f1f1;
            border-radius: 10px;
        }
        
        .admin-orders {
            margin-top: 15px;
        }
        
        .user-order {
            background-color: white;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .user-info {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .tg-info {
            margin-top: 5px;
            color: #3498db;
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        
        /* Уведомление */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: fadeIn 0.3s;
            max-width: 90%;
        }
        
        /* Для экранов больше 768px */
        @media (min-width: 768px) {
            .container {
                width: 90%;
            }
            
            .hero h1 {
                font-size: 36px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .section-title {
                font-size: 30px;
            }
            
            .about-content {
                flex-direction: row;
                gap: 30px;
            }
            
            .about-text {
                order: 1;
            }
            
            .about-image {
                order: 2;
            }
            
            .contact-info {
                flex-direction: row;
                gap: 20px;
            }
            
            .contact-card {
                flex: 1;
            }
            
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
            
            .product-modal {
                flex-direction: row;
                gap: 30px;
            }
            
            .product-modal-image {
                width: 50%;
            }
            
            .product-modal-info {
                width: 50%;
            }
            
            .product-modal-actions {
                flex-direction: row;
            }
            
            .cart-item {
                flex-direction: row;
            }
            
            .order-header {
                flex-direction: row;
                justify-content: space-between;
            }
        }
        
        /* Для экранов больше 992px */
        @media (min-width: 992px) {
            .products-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">ГЛОБУС</div>
                <div class="nav-buttons">
                    <a href="#" id="profileBtn" class="nav-button profile-btn">Профиль</a>
                    <a href="#" id="cartBtn" class="nav-button cart-btn">Корзина <span class="cart-count">0</span></a>
                </div>
            </div>
        </div>
    </header>
    
    <main id="mainContent">
        <section class="hero">
            <h1>Магазин канцелярии ГЛОБУС</h1>
            <p>Широкий ассортимент качественных канцелярских товаров для офиса, школы и творчества</p>
            <a href="#products" class="btn">Перейти к товарам</a>
        </section>
        
        <section id="products" class="products">
            <div class="container">
                <h2 class="section-title">Наши товары</h2>
                
                <div class="categories">
                    <button class="category-btn active">Все товары</button>
                    <button class="category-btn">Ручки</button>
                    <button class="category-btn">Тетради</button>
                    <button class="category-btn">Бумага</button>
                    <button class="category-btn">Офис</button>
                    <button class="category-btn">Творчество</button>
                </div>
                
                <div class="products-grid">
                    <!-- Товары будут загружены через JS -->
                </div>
            </div>
        </section>
        
        <section class="about">
            <div class="container">
                <h2 class="section-title">О нашем магазине</h2>
                <div class="about-content">
                    <div class="about-text">
                        <p>Магазин "ГЛОБУС" - это место, где вы найдете все необходимое для работы, учебы и творчества. Мы работаем на рынке канцелярских товаров более 10 лет и за это время заслужили доверие тысяч клиентов.</p>
                        <p>В нашем ассортименте представлены товары от ведущих мировых производителей: ручки, карандаши, тетради, блокноты, бумага, папки, скрепки и многое другое. Мы тщательно отбираем продукцию, чтобы предложить нашим клиентам только лучшее.</p>
                        <p>Наши цены приятно удивят вас, а качество обслуживания сделает покупки комфортными и приятными.</p>
                    </div>
                    <div class="about-image">
                        <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Канцелярские товары">
                    </div>
                </div>
            </div>
        </section>
        
        <section class="contacts">
            <div class="container">
                <h2 class="section-title">Контакты</h2>
                <div class="contact-info">
                    <div class="contact-card">
                        <h3>Адрес</h3>
                        <p>г. Москва, ул. Канцелярская, д. 15</p>
                        <p>ТЦ "Офисный", 2 этаж</p>
                    </div>
                    <div class="contact-card">
                        <h3>Телефон</h3>
                        <p>+7 (495) 123-45-67</p>
                        <p>+7 (800) 123-45-67</p>
                    </div>
                    <div class="contact-card">
                        <h3>Режим работы</h3>
                        <p>Пн-Пт: 9:00 - 21:00</p>
                        <p>Сб-Вс: 10:00 - 20:00</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Модальное окно товара -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="product-modal">
                <div class="product-modal-image">
                    <img id="modalProductImage" src="" alt="">
                </div>
                <div class="product-modal-info">
                    <h2 id="modalProductTitle" class="product-modal-title"></h2>
                    <div id="modalProductPrice" class="product-modal-price"></div>
                    <p id="modalProductDescription" class="product-modal-description"></p>
                    
                    <div class="product-modal-actions">
                        <div class="quantity-selector">
                            <button class="quantity-btn minus">-</button>
                            <input type="number" class="quantity-input" value="1" min="1">
                            <button class="quantity-btn plus">+</button>
                        </div>
                        <button id="addToCartModal" class="btn">Добавить в корзину</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>© 2023 Магазин канцелярии "ГЛОБУС". Все права защищены.</p>
        </div>
    </footer>
    
    <script>
        // Данные товаров
        const productsData = {
            1: {
                title: "Ручка гелевая синяя",
                price: 45,
                description: "Гелевая ручка с синими чернилами. Плавное письмо без протекания. Корпус из прочного пластика. Длина линии письма: до 1500 м.",
                image: "https://images.unsplash.com/photo-1585771724684-38269d6639fd?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Ручки"
            },
            2: {
                title: "Тетрадь 48 листов",
                price: 120,
                description: "Тетрадь в клетку с 48 листами. Обложка из плотного картона с ламинацией. Внутренний блок из офсетной бумаги плотностью 60 г/м².",
                image: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Тетради"
            },
            3: {
                title: "Бумага А4 (500 листов)",
                price: 450,
                description: "Офисная бумага формата А4, плотность 80 г/м². Белизна 146%. Подходит для лазерных и струйных printers. Упаковка 500 листов.",
                image: "https://images.unsplash.com/photo-1603484477859-abe6a73f9366?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Бумага"
            },
            4: {
                title: "Степлер металлический",
                price: 350,
                description: "Металлический степлер на 20 листов. В комплекте 1000 скоб. Резиновая накладка для удобного использования. Гарантия 1 год.",
                image: "https://images.unsplash.com/photo-1596524430615-b46475ddff6e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Офис"
            },
            5: {
                title: "Краски акварельные (12 цветов)",
                price: 680,
                description: "Набор акварельных красок в кюветах, 12 цветов. Яркие, насыщенные цвета. Легко размываются водой. В комплекте кисть.",
                image: "https://images.unsplash.com/photo-1548425087-15a44711725f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Творчество"
            },
            6: {
                title: "Набор ручек (4 цвета)",
                price: 180,
                description: "Набор гелевых ручек 4 цвета (синий, красный, зеленый, черный). Эргономичный корпус. Длина линии письма: до 1200 м на каждую ручку.",
                image: "https://images.unsplash.com/photo-1519861531473-9200262188bf?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Ручки"
            },
            7: {
                title: "Тетрадь 96 листов",
                price: 210,
                description: "Тетрадь в линейку с 96 листами. Обложка с твердым переплетом. Бумага повышенной плотности (70 г/м²). Подходит для конспектов.",
                image: "https://images.unsplash.com/photo-1568043210943-0e8aac4b9734?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Тетради"
            },
            8: {
                title: "Папка для документов",
                price: 290,
                description: "Папка-регистратор с арочным механизмом. Вмещает до 250 листов. Обложка из плотного картона с виниловым покрытием. Размер А4.",
                image: "https://images.unsplash.com/photo-1579530190412-b35a65e17c8d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                category: "Офис"
            }
        };
        
        // Глобальные переменные
        let cart = [];
        let currentUser = null;
        let allOrders = [];
        let currentProductId = null;
        const adminTelegramId = "ADMIN_TELEGRAM_ID"; // Замените на реальный ID админа в Telegram
        
        // Элементы страницы
        const mainContent = document.getElementById('mainContent');
        const profileBtn = document.getElementById('profileBtn');
        const cartBtn = document.getElementById('cartBtn');
        const cartCountElement = document.querySelector('.cart-count');
        const productModal = document.getElementById('productModal');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        
        // Проверяем, открыто ли приложение в Telegram WebView
        const isTelegramWebApp = window.Telegram && window.Telegram.WebApp;
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Инициализация Telegram WebApp
            if (isTelegramWebApp) {
                initTelegramWebApp();
            } else {
                // Проверяем, есть ли сохраненный пользователь (для обычного браузера)
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    updateProfileButton();
                }
            }
            
            // Проверяем, есть ли сохраненные заказы
            const savedOrders = localStorage.getItem('allOrders');
            if (savedOrders) {
                allOrders = JSON.parse(savedOrders);
            }
            
            // Проверяем, есть ли сохраненная корзина
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartCount();
            }
            
            // Загружаем товары
            loadProducts();
            
            // Инициализируем обработчики событий
            initEventHandlers();
        });
        
        // Инициализация Telegram WebApp
        function initTelegramWebApp() {
            const tg = window.Telegram.WebApp;
            
            // Развернуть приложение на весь экран
            tg.expand();
            
            // Получаем данные пользователя из Telegram
            const tgUser = tg.initDataUnsafe.user;
            
            if (tgUser) {
                // Автоматически входим под пользователем Telegram
                currentUser = {
                    id: tgUser.id.toString(),
                    name: tgUser.first_name || 'Пользователь',
                    username: tgUser.username || '',
                    isAdmin: tgUser.id.toString() === adminTelegramId,
                    orders: []
                };
                
                // Если это админ, добавляем дополнительные данные
                if (currentUser.isAdmin) {
                    currentUser.name = 'Администратор';
                }
                
                updateProfileButton();
                
                // Проверяем, есть ли сохраненные данные для этого пользователя
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const existingUser = users.find(u => u.id === currentUser.id);
                
                if (existingUser) {
                    // Обновляем данные пользователя
                    currentUser = {
                        ...currentUser,
                        orders: existingUser.orders || [],
                        address: existingUser.address,
                        phone: existingUser.phone
                    };
                } else {
                    // Сохраняем нового пользователя
                    const newUser = {
                        ...currentUser,
                        address: '',
                        phone: '',
                        orders: []
                    };
                    
                    users.push(newUser);
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                saveUser();
            }
        }
        
        // Загрузка товаров
        function loadProducts() {
            const productsGrid = document.querySelector('.products-grid');
            if (productsGrid) {
                productsGrid.innerHTML = generateProductCards();
                initProductHandlers();
            }
        }
        
        // Обработчики событий для навигации
        function initEventHandlers() {
            profileBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) {
                    showProfilePage();
                } else if (isTelegramWebApp) {
                    // В Telegram WebApp пользователь всегда должен быть авторизован
                    showProfilePage();
                }
            });
            
            cartBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showCartPage();
            });
            
            // Обработчики для модального окна товара
            document.querySelector('.quantity-btn.minus').addEventListener('click', () => {
                const input = document.querySelector('.quantity-input');
                if (input.value > 1) {
                    input.value--;
                }
            });
            
            document.querySelector('.quantity-btn.plus').addEventListener('click', () => {
                const input = document.querySelector('.quantity-input');
                input.value++;
            });
            
            document.getElementById('addToCartModal').addEventListener('click', () => {
                if (currentProductId) {
                    const quantity = parseInt(document.querySelector('.quantity-input').value);
                    addToCart(currentProductId, quantity);
                    productModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Обработчики для закрытия модальных окон
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                    document.body.style.overflow = 'auto';
                });
            });
            
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        // Функции для отображения страниц
        function showCartPage() {
            if (cart.length === 0) {
                mainContent.innerHTML = `
                    <div class="container cart-page">
                        <a href="#" class="btn btn-back" id="backToHome">Назад в каталог</a>
                        <h2 class="section-title">Корзина пуста</h2>
                        <p>В вашей корзине пока нет товаров. Перейдите в каталог, чтобы добавить товары.</p>
                        <a href="#products" class="btn">Перейти к товарам</a>
                    </div>
                `;
                
                document.getElementById('backToHome').addEventListener('click', (e) => {
                    e.preventDefault();
                    showHomePage();
                });
                
                return;
            }
            
            mainContent.innerHTML = `
                <div class="container cart-page">
                    <a href="#" class="btn btn-back" id="backToHome">Назад в каталог</a>
                    <h2 class="section-title">Ваша корзина</h2>
                    
                    <div class="cart-items">
                        ${generateCartItems()}
                    </div>
                    
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>Товары (${getTotalItems()} шт.)</span>
                            <span>${getSubtotal()} ₽</span>
                        </div>
                        <div class="summary-row">
                            <span>Доставка</span>
                            <span>${calculateDelivery()} ₽</span>
                        </div>
                        <div class="summary-row total">
                            <span>Итого</span>
                            <span>${getTotal()} ₽</span>
                        </div>
                    </div>
                    
                    <button class="btn" id="checkoutBtn" style="width: 100%; margin-top: 20px;">Оформить заказ</button>
                </div>
            `;
            
            // Инициализируем обработчики событий для корзины
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.closest('.cart-item').getAttribute('data-id');
                    removeFromCart(productId);
                    showCartPage();
                });
            });
            
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const productId = e.target.closest('.cart-item').getAttribute('data-id');
                    const newQuantity = parseInt(e.target.value);
                    updateCartItemQuantity(productId, newQuantity);
                    showCartPage();
                });
            });
            
            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (currentUser) {
                    showCheckoutPage();
                }
            });
            
            document.getElementById('backToHome').addEventListener('click', (e) => {
                e.preventDefault();
                showHomePage();
            });
        }
        
        function showCheckoutPage() {
            mainContent.innerHTML = `
                <div class="container">
                    <a href="#" class="btn btn-back" id="backToCart">Назад в корзину</a>
                    <h2 class="section-title">Оформление заказа</h2>
                    
                    <div class="checkout-form">
                        <h3>Данные для доставки</h3>
                        <div class="form-group">
                            <label for="checkoutName">ФИО</label>
                            <input type="text" id="checkoutName" value="${currentUser.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="checkoutPhone">Телефон</label>
                            <input type="tel" id="checkoutPhone" value="${currentUser.phone || ''}" required>
                        </div>
                        <div class="form-group">
                            <label for="checkoutAddress">Адрес доставки</label>
                            <textarea id="checkoutAddress" rows="3" required>${currentUser.address || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="checkoutComment">Комментарий к заказу</label>
                            <textarea id="checkoutComment" rows="3"></textarea>
                        </div>
                        
                        <h3 style="margin-top: 20px;">Способ оплаты</h3>
                        <div class="form-group">
                            <select id="paymentMethod">
                                <option value="cash">Наличными при получении</option>
                                <option value="card">Банковской картой онлайн</option>
                            </select>
                        </div>
                        
                        <div class="cart-summary" style="margin-top: 20px;">
                            <div class="summary-row">
                                <span>Товары (${getTotalItems()} шт.)</span>
                                <span>${getSubtotal()} ₽</span>
                            </div>
                            <div class="summary-row">
                                <span>Доставка</span>
                                <span>${calculateDelivery()} ₽</span>
                            </div>
                            <div class="summary-row total">
                                <span>Итого</span>
                                <span>${getTotal()} ₽</span>
                            </div>
                        </div>
                        
                        <button class="btn" id="placeOrderBtn" style="width: 100%; margin-top: 20px;">Подтвердить заказ</button>
                    </div>
                </div>
            `;
            
            document.getElementById('placeOrderBtn').addEventListener('click', placeOrder);
            document.getElementById('backToCart').addEventListener('click', (e) => {
                e.preventDefault();
                showCartPage();
            });
        }
        
        function showProfilePage() {
            let ordersHtml = '';
            
            if (currentUser.orders && currentUser.orders.length > 0) {
                ordersHtml = `
                    <h3 style="margin-top: 30px;">Ваши заказы</h3>
                    <div class="profile-orders">
                        ${generateUserOrders(currentUser.orders)}
                    </div>
                `;
            } else {
                ordersHtml = '<p>У вас пока нет заказов.</p>';
            }
            
            let adminPanel = '';
            if (currentUser.isAdmin) {
                adminPanel = `
                    <div class="admin-panel">
                        <h3>Административная панель</h3>
                        <p>Всего заказов: ${allOrders.length}</p>
                        
                        <div class="admin-orders">
                            <h4>Последние заказы:</h4>
                            ${generateAllOrders()}
                        </div>
                    </div>
                `;
            }
            
            mainContent.innerHTML = `
                <div class="container profile-page">
                    <a href="#" class="btn btn-back" id="backToHome">Назад в каталог</a>
                    <div class="profile-header">
                        <div class="profile-avatar">${currentUser.name.charAt(0).toUpperCase()}</div>
                        <div class="profile-info">
                            <h2>${currentUser.name}</h2>
                            ${currentUser.username ? `<p>@${currentUser.username}</p>` : ''}
                            ${currentUser.phone ? `<p>Телефон: ${currentUser.phone}</p>` : ''}
                            ${currentUser.address ? `<p>Адрес: ${currentUser.address}</p>` : ''}
                        </div>
                    </div>
                    
                    ${ordersHtml}
                    ${adminPanel}
                </div>
            `;
            
            document.getElementById('backToHome').addEventListener('click', (e) => {
                e.preventDefault();
                showHomePage();
            });
            
            // Инициализация обработчиков для админских кнопок
            if (currentUser.isAdmin) {
                document.querySelectorAll('[data-order-id]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = parseInt(e.target.getAttribute('data-order-id'));
                        const action = e.target.getAttribute('data-action');
                        
                        let status;
                        switch (action) {
                            case 'process': status = 'В обработке'; break;
                            case 'ship': status = 'Отправлен'; break;
                            case 'complete': status = 'Завершен'; break;
                        }
                        
                        if (status) {
                            updateOrderStatus(orderId, status);
                        }
                    });
                });
            }
        }
        
        function showOrderSuccessPage(order) {
            mainContent.innerHTML = `
                <div class="container" style="text-align: center; padding: 60px 0;">
                    <h2 class="section-title">Заказ успешно оформлен!</h2>
                    <p style="font-size: 16px; margin-bottom: 20px;">Номер вашего заказа: #${order.id}</p>
                    <p style="font-size: 16px; margin-bottom: 20px;">Сумма заказа: ${order.total} ₽</p>
                    <p style="font-size: 16px; margin-bottom: 30px;">Мы свяжемся с вами для подтверждения заказа.</p>
                    <a href="#" class="btn" id="backToHome">Вернуться на главную</a>
                </div>
            `;
            
            document.getElementById('backToHome').addEventListener('click', (e) => {
                e.preventDefault();
                showHomePage();
            });
            
            // Отправляем уведомление в Telegram, если это Mini App
            if (isTelegramWebApp) {
                sendTelegramNotification(order);
            }
        }
        
        function showHomePage() {
            mainContent.innerHTML = `
                <section class="hero">
                    <h1>Магазин канцелярии ГЛОБУС</h1>
                    <p>Широкий ассортимент качественных канцелярских товаров для офиса, школы и творчества</p>
                    <a href="#products" class="btn">Перейти к товарам</a>
                </section>
                
                <section id="products" class="products">
                    <div class="container">
                        <h2 class="section-title">Наши товары</h2>
                        
                        <div class="categories">
                            <button class="category-btn active">Все товары</button>
                            <button class="category-btn">Ручки</button>
                            <button class="category-btn">Тетради</button>
                            <button class="category-btn">Бумага</button>
                            <button class="category-btn">Офис</button>
                            <button class="category-btn">Творчество</button>
                        </div>
                        
                        <div class="products-grid">
                            ${generateProductCards()}
                        </div>
                    </div>
                </section>
                
                <section class="about">
                    <div class="container">
                        <h2 class="section-title">О нашем магазине</h2>
                        <div class="about-content">
                            <div class="about-text">
                                <p>Магазин "ГЛОБУС" - это место, где вы найдете все необходимое для работы, учебы и творчества. Мы работаем на рынке канцелярских товаров более 10 лет и за это время заслужили доверие тысяч клиентов.</p>
                                <p>В нашем ассортименте представлены товары от ведущих мировых производителей: ручки, карандаши, тетради, блокноты, бумага, папки, скрепки и многое другое. Мы тщательно отбираем продукцию, чтобы предложить нашим клиентам только лучшее.</p>
                                <p>Наши цены приятно удивят вас, а качество обслуживания сделает покупки комфортными и приятными.</p>
                            </div>
                            <div class="about-image">
                                <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Канцелярские товары">
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="contacts">
                    <div class="container">
                        <h2 class="section-title">Контакты</h2>
                        <div class="contact-info">
                            <div class="contact-card">
                                <h3>Адрес</h3>
                                <p>г. Москва, ул. Канцелярская, д. 15</p>
                                <p>ТЦ "Офисный", 2 этаж</p>
                            </div>
                            <div class="contact-card">
                                <h3>Телефон</h3>
                                <p>+7 (495) 123-45-67</p>
                                <p>+7 (800) 123-45-67</p>
                            </div>
                            <div class="contact-card">
                                <h3>Режим работы</h3>
                                <p>Пн-Пт: 9:00 - 21:00</p>
                                <p>Сб-Вс: 10:00 - 20:00</p>
                            </div>
                        </div>
                    </div>
                </section>
            `;
            
            // Инициализируем обработчики событий для товаров
            initProductHandlers();
        }
        
        // Генераторы HTML
        function generateProductCards() {
            return Object.keys(productsData).map(id => `
                <div class="product-card" data-id="${id}" data-category="${productsData[id].category}">
                    <div class="product-image">
                        <img src="${productsData[id].image}" alt="${productsData[id].title}">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${productsData[id].title}</h3>
                        <div class="product-price">${productsData[id].price} ₽</div>
                        <button class="add-to-cart">В корзину</button>
                    </div>
                </div>
            `).join('');
        }
        
        function generateCartItems() {
            return cart.map(item => `
                <div class="cart-item" data-id="${item.id}">
                    <img src="${item.image}" alt="${item.title}" class="cart-item-image">
                    <div class="cart-item-details">
                        <h4 class="cart-item-title">${item.title}</h4>
                        <div class="cart-item-price">${item.price} ₽</div>
                    </div>
                    <div class="cart-item-actions">
                        <input type="number" class="quantity-input" value="${item.quantity}" min="1">
                        <span class="remove-item">&times;</span>
                    </div>
                </div>
            `).join('');
        }
        
        function generateUserOrders(orders) {
            return orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <strong>Заказ #${order.id}</strong>
                            <span style="margin-left: 10px; color: #7f8c8d;">${formatDate(order.date)}</span>
                        </div>
                        <div>
                            <strong>${order.total} ₽</strong>
                            <span style="margin-left: 10px; color: ${getStatusColor(order.status)}">${order.status}</span>
                        </div>
                    </div>
                    <div class="order-products">
                        ${order.items.map(item => `
                            <div class="order-product">
                                <img src="${item.image}" alt="${item.title}">
                                <div>
                                    <div>${item.title}</div>
                                    <div>${item.price} ₽ × ${item.quantity} = ${item.price * item.quantity} ₽</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function generateAllOrders() {
            return allOrders.slice().reverse().slice(0, 5).map(order => `
                <div class="user-order">
                    <div class="user-info">
                        ${order.user.name} 
                        ${order.user.username ? `(@${order.user.username})` : ''}
                    </div>
                    <div class="tg-info">
                        Телефон: ${order.user.phone || 'не указан'}
                    </div>
                    <div>
                        <strong>Заказ #${order.id}</strong> - ${order.total} ₽ - ${formatDate(order.date)} - 
                        <span style="color: ${getStatusColor(order.status)}">${order.status}</span>
                    </div>
                    <div>
                        Адрес: ${order.user.address || 'не указан'}
                    </div>
                    ${currentUser.isAdmin ? `
                    <div style="margin-top: 10px;">
                        <button class="btn" data-order-id="${order.id}" data-action="process" style="padding: 5px 10px; font-size: 14px; margin-right: 5px;">В обработке</button>
                        <button class="btn" data-order-id="${order.id}" data-action="ship" style="padding: 5px 10px; font-size: 14px; margin-right: 5px;">Отправлен</button>
                        <button class="btn" data-order-id="${order.id}" data-action="complete" style="padding: 5px 10px; font-size: 14px;">Завершен</button>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // Функции для работы с корзиной
        function addToCart(productId, quantity) {
            const product = productsData[productId];
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: productId,
                    title: product.title,
                    price: product.price,
                    quantity: quantity,
                    image: product.image
                });
            }
            
            updateCartCount();
            saveCart();
            showNotification(`Добавлено "${product.title}" (${quantity} шт.) в корзину`);
        }
        
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartCount();
            saveCart();
            showNotification('Товар удален из корзины');
        }
        
        function updateCartItemQuantity(productId, newQuantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                saveCart();
            }
        }
        
        function getSubtotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }
        
        function getTotalItems() {
            return cart.reduce((sum, item) => sum + item.quantity, 0);
        }
        
        function calculateDelivery() {
            return getSubtotal() > 2000 ? 0 : 300;
        }
        
        function getTotal() {
            return getSubtotal() + calculateDelivery();
        }
        
        function updateCartCount() {
            const totalItems = getTotalItems();
            cartCountElement.textContent = totalItems;
        }
        
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }
        
        // Функции для работы с заказами
        function placeOrder() {
            const name = document.getElementById('checkoutName').value;
            const phone = document.getElementById('checkoutPhone').value;
            const address = document.getElementById('checkoutAddress').value;
            const comment = document.getElementById('checkoutComment').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (!name || !phone || !address) {
                showNotification('Пожалуйста, заполните все обязательные поля', 'error');
                return;
            }
            
            // Обновляем данные пользователя
            currentUser.phone = phone;
            currentUser.address = address;
            saveUser();
            
            // Создаем заказ
            const order = {
                id: generateOrderId(),
                date: new Date().toISOString(),
                user: {
                    id: currentUser.id,
                    name: currentUser.name,
                    username: currentUser.username || '',
                    phone: currentUser.phone,
                    address: currentUser.address
                },
                items: [...cart],
                subtotal: getSubtotal(),
                delivery: calculateDelivery(),
                total: getTotal(),
                paymentMethod: paymentMethod,
                status: 'Новый',
                comment: comment
            };
            
            // Добавляем заказ в историю пользователя
            if (!currentUser.orders) {
                currentUser.orders = [];
            }
            currentUser.orders.push(order);
            saveUser();
            
            // Добавляем заказ в общий список заказов
            allOrders.push(order);
            saveAllOrders();
            
            // Очищаем корзину
            cart = [];
            saveCart();
            updateCartCount();
            
            // Показываем страницу успешного оформления заказа
            showOrderSuccessPage(order);
        }
        
        function generateOrderId() {
            return Math.floor(100000 + Math.random() * 900000);
        }
        
        function updateOrderStatus(orderId, status) {
            // Обновляем в общих заказах
            const orderIndex = allOrders.findIndex(o => o.id === orderId);
            if (orderIndex !== -1) {
                allOrders[orderIndex].status = status;
                saveAllOrders();
            }
            
            // Обновляем в заказах пользователя (если он есть)
            if (currentUser && currentUser.orders) {
                const userOrderIndex = currentUser.orders.findIndex(o => o.id === orderId);
                if (userOrderIndex !== -1) {
                    currentUser.orders[userOrderIndex].status = status;
                    saveUser();
                }
            }
            
            // Если мы на странице профиля, обновляем ее
            if (mainContent.querySelector('.profile-page')) {
                showProfilePage();
            }
            
            // Отправляем уведомление в Telegram, если статус изменил админ
            if (currentUser.isAdmin && isTelegramWebApp) {
                sendStatusUpdateNotification(orderId, status);
            }
        }
        
        function saveAllOrders() {
            localStorage.setItem('allOrders', JSON.stringify(allOrders));
        }
        
        // Функции для работы с пользователем
        function saveUser() {
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Также обновляем информацию в списке пользователей
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                
                if (userIndex !== -1) {
                    users[userIndex] = {
                        ...users[userIndex],
                        name: currentUser.name,
                        phone: currentUser.phone,
                        address: currentUser.address,
                        orders: currentUser.orders || []
                    };
                } else {
                    users.push({
                        ...currentUser,
                        orders: currentUser.orders || []
                    });
                }
                
                localStorage.setItem('users', JSON.stringify(users));
            }
        }
        
        function updateProfileButton() {
            if (currentUser) {
                profileBtn.textContent = currentUser.name.split(' ')[0]; // Показываем только имя
            } else {
                profileBtn.textContent = 'Профиль';
            }
        }
        
        // Вспомогательные функции
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function getStatusColor(status) {
            switch (status) {
                case 'Новый': return '#3498db';
                case 'В обработке': return '#f39c12';
                case 'Отправлен': return '#9b59b6';
                case 'Завершен': return '#2ecc71';
                case 'Отменен': return '#e74c3c';
                default: return '#7f8c8d';
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.backgroundColor = type === 'error' ? '#e74c3c' : '#2ecc71';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Инициализация обработчиков событий для товаров
        function initProductHandlers() {
            // Обработчики для карточек товаров
            document.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.classList.contains('add-to-cart')) {
                        return;
                    }
                    
                    const productId = card.getAttribute('data-id');
                    const product = productsData[productId];
                    
                    document.getElementById('modalProductImage').src = product.image;
                    document.getElementById('modalProductTitle').textContent = product.title;
                    document.getElementById('modalProductPrice').textContent = `${product.price} ₽`;
                    document.getElementById('modalProductDescription').textContent = product.description;
                    document.querySelector('.quantity-input').value = 1;
                    
                    document.getElementById('productModal').style.display = 'block';
                    document.body.style.overflow = 'hidden';
                    
                    // Устанавливаем текущий товар
                    currentProductId = productId;
                });
            });
            
            // Обработчики для кнопок "В корзину" на карточках товаров
            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = btn.closest('.product-card').getAttribute('data-id');
                    addToCart(productId, 1);
                });
            });
            
            // Обработчики для фильтрации по категориям
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const category = btn.textContent;
                    const productCards = document.querySelectorAll('.product-card');
                    
                    productCards.forEach(card => {
                        if (category === 'Все товары' || card.getAttribute('data-category') === category) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        }
        
        // Функции для работы с Telegram
        function sendTelegramNotification(order) {
            const tg = window.Telegram.WebApp;
            
            // Отправляем данные о заказе пользователю
            tg.sendData(JSON.stringify({
                type: 'order_created',
                orderId: order.id,
                total: order.total,
                status: order.status
            }));
            
            // Если пользователь не админ, отправляем уведомление админу
            if (!currentUser.isAdmin) {
                // В реальном приложении здесь был бы запрос к серверу для отправки уведомления админу
                console.log(`Админ получит уведомление о новом заказе #${order.id}`);
            }
        }
        
        function sendStatusUpdateNotification(orderId, status) {
            const tg = window.Telegram.WebApp;
            
            // Находим заказ
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            // Отправляем данные об изменении статуса пользователю
            tg.sendData(JSON.stringify({
                type: 'order_status_changed',
                orderId: order.id,
                status: status
            }));
        }
    </script>
</body>
</html>