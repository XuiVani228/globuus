<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .profile {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .name {
            font-size: 18px;
            font-weight: bold;
        }
        .button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #2481cc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
        }
        .button:hover {
            background: #1c6bb0;
        }
        .lottery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .lottery-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .lottery-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .seat {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
        }
        .seat.booked {
            background: #ff6b6b;
            cursor: not-allowed;
        }
        .seat.selected {
            background: #4CAF50;
            color: white;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .hidden {
            display: none;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let currentUserId = new URLSearchParams(window.location.search).get('user_id');
        let isAdmin = currentUserId === '123456789'; // –í–∞—à ID –∞–¥–º–∏–Ω–∞
        let currentLottery = null;
        let selectedSeat = null;

        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è
            const profileName = document.getElementById('profile-name');
            profileName.textContent = isAdmin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å';

            // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ—Ç–µ—Ä–µ–π
            if (isAdmin) {
                document.getElementById('admin-panel').classList.remove('hidden');
            } else {
                loadLotteries();
            }
        });

        function loadLotteries() {
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ—Ç–µ—Ä–µ–π
            // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫-–¥–∞–Ω–Ω—ã–µ
            const mockLotteries = [
                {
                    id: 1,
                    title: "–õ–æ—Ç–µ—Ä–µ—è 1",
                    description: "–û–ø–∏—Å–∞–Ω–∏–µ –ª–æ—Ç–µ—Ä–µ–∏ 1",
                    price: 1000,
                    total_seats: 10,
                    photo: "https://via.placeholder.com/300"
                },
                {
                    id: 2,
                    title: "–õ–æ—Ç–µ—Ä–µ—è 2",
                    description: "–û–ø–∏—Å–∞–Ω–∏–µ –ª–æ—Ç–µ—Ä–µ–∏ 2",
                    price: 2000,
                    total_seats: 15,
                    photo: "https://via.placeholder.com/300"
                }
            ];

            const grid = document.getElementById('lottery-grid');
            grid.innerHTML = '';

            mockLotteries.forEach(lottery => {
                const card = document.createElement('div');
                card.className = 'lottery-card';
                card.innerHTML = `
                    <img src="${lottery.photo}" class="lottery-image">
                    <h3>${lottery.title}</h3>
                    <p>${lottery.description}</p>
                    <p>–¶–µ–Ω–∞: ${lottery.price} —Ä—É–±.</p>
                    <button onclick="viewLottery(${lottery.id})">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                `;
                grid.appendChild(card);
            });
        }

        function viewLottery(lotteryId) {
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ª–æ—Ç–µ—Ä–µ–µ
            currentLottery = {
                id: 1,
                title: "–õ–æ—Ç–µ—Ä–µ—è 1",
                description: "–û–ø–∏—Å–∞–Ω–∏–µ –ª–æ—Ç–µ—Ä–µ–∏ 1",
                price: 1000,
                total_seats: 10,
                photo: "https://via.placeholder.com/300"
            };

            document.getElementById('lottery-view').classList.remove('hidden');
            document.getElementById('lottery-title').textContent = currentLottery.title;
            document.getElementById('lottery-description').textContent = currentLottery.description;
            document.getElementById('lottery-price').textContent = `–¶–µ–Ω–∞: ${currentLottery.price} —Ä—É–±.`;
            document.getElementById('lottery-image').src = currentLottery.photo;

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Å—Ç
            const seatsContainer = document.getElementById('seats-container');
            seatsContainer.innerHTML = '';

            for (let i = 1; i <= currentLottery.total_seats; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.textContent = i;
                seat.onclick = function() {
                    if (!seat.classList.contains('booked')) {
                        document.querySelectorAll('.seat').forEach(s => s.classList.remove('selected'));
                        seat.classList.add('selected');
                        selectedSeat = i;
                    }
                };
                seatsContainer.appendChild(seat);
            }
        }

        function bookSeat() {
            if (!selectedSeat) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ!');
                return;
            }

            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify({
                    action: 'book_seat',
                    lottery_id: currentLottery.id,
                    seat_number: selectedSeat
                }));
            } else {
                alert(`–ú–µ—Å—Ç–æ ${selectedSeat} –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ!`);
            }
        }

        function createLottery() {
            const title = document.getElementById('lottery-title-input').value;
            const description = document.getElementById('lottery-description-input').value;
            const price = document.getElementById('lottery-price-input').value;
            const seats = document.getElementById('lottery-seats-input').value;
            const photo = document.getElementById('lottery-photo-input').value || "https://via.placeholder.com/300";

            if (!title || !description || !price || !seats) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify({
                    action: 'create_lottery',
                    title: title,
                    description: description,
                    price: parseFloat(price),
                    seats: parseInt(seats),
                    photo: photo
                }));
            } else {
                alert('–õ–æ—Ç–µ—Ä–µ—è —Å–æ–∑–¥–∞–Ω–∞!');
                document.getElementById('create-lottery-form').reset();
            }
        }

        function showCreateForm() {
            document.getElementById('create-lottery-form').classList.remove('hidden');
        }
    </script>
</head>
<body>
    <div class="profile">
        <div class="avatar">üë§</div>
        <div class="name" id="profile-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <button class="button" onclick="window.location.href='index.html'">‚Üê –ù–∞–∑–∞–¥</button>

    <div id="admin-panel" class="hidden">
        <h2>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
        <button class="button" onclick="showCreateForm()">–°–æ–∑–¥–∞—Ç—å –ª–æ—Ç–µ—Ä–µ—é</button>
        
        <div id="create-lottery-form" class="hidden">
            <div class="form-group">
                <label for="lottery-title-input">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="lottery-title-input" required>
            </div>
            <div class="form-group">
                <label for="lottery-description-input">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="lottery-description-input" required></textarea>
            </div>
            <div class="form-group">
                <label for="lottery-price-input">–¶–µ–Ω–∞ (—Ä—É–±):</label>
                <input type="number" id="lottery-price-input" required>
            </div>
            <div class="form-group">
                <label for="lottery-seats-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç:</label>
                <input type="number" id="lottery-seats-input" required>
            </div>
            <div class="form-group">
                <label for="lottery-photo-input">URL —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                <input type="text" id="lottery-photo-input">
            </div>
            <button class="button" onclick="createLottery()">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>

    <div id="user-view">
        <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ—Ç–µ—Ä–µ–∏</h2>
        <div id="lottery-grid" class="lottery-grid"></div>
        
        <div id="lottery-view" class="hidden">
            <h2 id="lottery-title"></h2>
            <img id="lottery-image" class="lottery-image">
            <p id="lottery-description"></p>
            <p id="lottery-price"></p>
            
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ:</h3>
            <div id="seats-container" class="seat-grid"></div>
            
            <button class="button" onclick="bookSeat()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            <button class="button" onclick="document.getElementById('lottery-view').classList.add('hidden')">–ù–∞–∑–∞–¥</button>
        </div>
    </div>
</body>
</html>